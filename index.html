<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <script>
      (function(){
        var saved = localStorage.getItem('bird-game-theme');
        if (saved === 'light') document.documentElement.setAttribute('data-theme', 'light');
        else if (saved === 'dark') document.documentElement.removeAttribute('data-theme');
        else if (typeof window !== 'undefined' && window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches)
          document.documentElement.setAttribute('data-theme', 'light');
      })();
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <title>Bird Game</title>
    <style>
      /* ========== Addicted-style design tokens (responsive-first) ========== */
      :root {
        --bg-deep: #08080a;
        --bg-surface: #0e0e10;
        --bg-card: #12121a;
        --bg-elevated: #18181f;
        --bg-hover: #222228;
        --border: #1e1e24;
        --border-subtle: #1a1a1f;
        --text: #f4f4f5;
        --text-muted: #6b6b75;
        --accent: #10b981;
        --accent-dim: rgba(16, 185, 129, 0.15);
        --radius: 4px;
        --header-h: 56px;
        --tabs-h: 44px;
        --touch-min: 44px;
        --content-pad: 16px;
        --content-max: 960px;
      }
      /* ライトテーマ（data-theme="light" を html に付与で切り替え） */
      [data-theme="light"] {
        --bg-deep: #f4f4f5;
        --bg-surface: #ffffff;
        --bg-card: #ffffff;
        --bg-elevated: #fafafa;
        --bg-hover: #eeeeef;
        --border: #e4e4e7;
        --border-subtle: #eaeaea;
        --text: #18181b;
        --text-muted: #8b7355;
        --accent: #059669;
        --accent-dim: rgba(5, 150, 105, 0.12);
      }

      @media (min-width: 768px) {
        :root {
          --content-pad: 20px;
        }
      }

      * { margin: 0; padding: 0; box-sizing: border-box; }
      html {
        -webkit-tap-highlight-color: transparent;
        /* Prevent global centering shift when page scrollbar toggles (Title ↔ Shell). */
        scrollbar-gutter: stable;
      }
      @supports not (scrollbar-gutter: stable) {
        html { overflow-y: scroll; }
      }
      body {
        width: 100%;
        min-height: 100vh;
        background: var(--bg-deep);
        color: var(--text);
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        font-size: 14px;
        line-height: 1.4;
        overflow-x: hidden;
        display: flex;
        flex-direction: column;
      }

      /* ========== Title (Connect) screen — Addicted tone ========== */
      #title-ui {
        display: none;
        position: fixed;
        inset: 0;
        z-index: 99999;
        background: var(--bg-deep);
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 24px;
        padding: 24px;
      }
      #title-ui.visible { display: flex; }
      #title-ui .title-text {
        font-size: clamp(22px, 5vw, 28px);
        font-weight: 600;
        letter-spacing: 0.03em;
        color: var(--text);
      }
      #title-ui .subtitle {
        font-size: 13px;
        color: var(--text-muted);
        letter-spacing: 0.02em;
      }
      #connect-wallet-btn {
        min-height: var(--touch-min);
        padding: 0 28px;
        font-size: 14px;
        font-weight: 500;
        letter-spacing: 0.02em;
        background: var(--bg-elevated);
        color: var(--text);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        cursor: pointer;
        transition: background 0.15s, border-color 0.15s;
      }
      #connect-wallet-btn:hover {
        background: var(--bg-card);
        border-color: var(--text-muted);
      }
      #connect-wallet-btn:disabled { opacity: 0.5; cursor: not-allowed; }

      /* ========== Game shell ========== */
      #game-shell {
        display: none;
        flex: 1;
        flex-direction: column;
        min-height: 100vh;
        z-index: 0;
      }
      #game-shell.visible { display: flex; }

      /* ----- Header ----- */
      .shell-header {
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 8px;
        padding: 8px var(--content-pad);
        background: var(--bg-surface);
        border-bottom: 1px solid var(--border);
      }
      .shell-header-left {
        display: flex;
        align-items: center;
        gap: 12px;
        min-height: 40px;
      }
      .shell-logo {
        font-size: 16px;
        font-weight: 600;
        letter-spacing: 0.02em;
        color: var(--text);
      }
      .shell-subtitle {
        font-size: 12px;
        color: var(--text-muted);
      }
      .shell-wallet-row {
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: 8px;
      }
      .shell-wallet {
        display: flex;
        align-items: center;
        height: 40px;
        min-height: 40px;
        padding: 0 14px;
        box-sizing: border-box;
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        font-size: 13px;
        font-variant-numeric: tabular-nums;
      }
      .shell-wallet-address { color: var(--text-muted); }
      .shell-disconnect-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        padding: 0;
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        color: var(--text-muted);
        cursor: pointer;
        transition: color 0.15s, background 0.15s, border-color 0.15s;
      }
      .shell-disconnect-btn:hover {
        color: var(--text);
        background: var(--bg-elevated);
        border-color: var(--text-muted);
      }
      .shell-disconnect-btn svg { width: 18px; height: 18px; }
      .shell-theme-btn {
        display: flex; align-items: center; justify-content: center;
        width: 40px; height: 40px; padding: 0;
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        color: var(--text-muted);
        cursor: pointer;
        transition: color 0.15s, background 0.15s, border-color 0.15s;
      }
      .shell-theme-btn:hover { color: var(--text); background: var(--bg-hover); border-color: var(--text-muted); }
      .shell-theme-btn svg { width: 20px; height: 20px; }
      .shell-theme-btn .theme-icon-light { display: none; }
      [data-theme="light"] .shell-theme-btn .theme-icon-dark { display: none; }
      [data-theme="light"] .shell-theme-btn .theme-icon-light { display: block; }
      [data-theme="light"] .shell-theme-btn,
      [data-theme="light"] .shell-theme-btn svg { color: var(--text-muted); }
      [data-theme="light"] .shell-theme-btn:hover,
      [data-theme="light"] .shell-theme-btn:hover svg { color: var(--text-muted); }

      /* ----- Tabs (sticky + z-index so one tap always switches from Adopt tab) ----- */
      .shell-tabs {
        flex-shrink: 0;
        position: sticky;
        top: 0;
        z-index: 20;
        display: flex;
        gap: 0;
        min-height: var(--tabs-h);
        padding: 0 var(--content-pad);
        background: var(--bg-surface);
        border-bottom: 1px solid var(--border);
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
      .shell-tabs::-webkit-scrollbar { height: 0; }
      .shell-tab {
        flex-shrink: 0;
        min-height: var(--touch-min);
        min-width: 80px;
        padding: 0 16px;
        font-size: 13px;
        font-weight: 500;
        color: var(--text-muted);
        background: none;
        border: none;
        border-bottom: 2px solid transparent;
        cursor: pointer;
        transition: color 0.15s, border-color 0.15s;
        touch-action: manipulation;
      }
      .shell-tab:hover { color: var(--text); }
      .shell-tab.active {
        color: var(--text);
        border-bottom-color: var(--accent);
      }
      .shell-tab.onboarding-tab-locked { opacity: 0.5; pointer-events: none; cursor: not-allowed; }

      /* ----- Status row (status cards + tab intro share same container width) ----- */
      .status-panel {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      /* ----- Content ----- */
      .shell-content {
        flex: 1;
        padding: var(--content-pad);
        overflow: auto;
        /* Prevent layout shift when scrollbar appears/disappears (tab content height differs). */
        scrollbar-gutter: stable;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
      /* Fallback for browsers without scrollbar-gutter: always reserve scrollbar width. */
      @supports not (scrollbar-gutter: stable) {
        .shell-content { overflow-y: scroll; }
      }
      .shell-content-inner {
        max-width: var(--content-max);
        margin: 0 auto;
        width: 100%;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
      .tab-pane { display: none; flex-direction: column; gap: 16px; }
      .tab-pane.active { display: flex; }
      /* 各タブ上部の帯（Farming風の枠）＋タイトル/説明 */
      .adopt-pane-body {
        padding: 0;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
      .gacha-cta {
        display: flex;
        gap: 12px;
        margin-bottom: 24px;
      }
      .gacha-option {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .shell-gacha-spin-btn {
        min-width: 120px;
        min-height: 48px;
        padding: 0 16px;
        font-size: 15px;
        font-weight: 600;
        color: #fff;
        background: var(--accent);
        border: none;
        border-radius: var(--radius);
        cursor: pointer;
        transition: opacity 0.15s, transform 0.15s;
        box-shadow: 0 2px 8px var(--accent-dim);
      }
      .shell-gacha-spin-btn:hover { opacity: 0.95; transform: scale(1.02); }
      .shell-gacha-spin-btn:active { transform: scale(0.98); }
      .shell-gacha-spin-btn:disabled,
      .shell-gacha-spin-btn.onboarding-locked { opacity: 0.5; cursor: not-allowed; transform: none; pointer-events: none; }
      @media (min-width: 400px) {
        .shell-gacha-spin-btn { min-height: 52px; font-size: 16px; }
      }
      .gacha-cost {
        font-size: 12px;
        color: var(--text-muted);
      }
      .gacha-cost.gacha-cost-insufficient {
        color: #f97373;
      }
      .gacha-results-section {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 16px;
      }
      /* ガチャを1回も回していない間は「Adopted birds」ブロックを非表示 */
      .gacha-results-section.gacha-results-section--hidden {
        display: none !important;
      }
      .gacha-results-label {
        font-size: 11px;
        font-weight: 500;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.06em;
        margin-bottom: 12px;
      }
      .gacha-results-area { min-height: 80px; display: flex; flex-wrap: wrap; gap: 8px; align-items: flex-start; }
      .gacha-results-empty {
        font-size: 13px;
        color: var(--text-muted);
        margin: 0;
      }
      .gacha-results-item {
        width: 56px;
        height: 56px;
        object-fit: contain;
        background: var(--bg-elevated);
        border: 1px solid var(--border);
        border-radius: var(--radius);
      }

      /* ----- Farming pane (HTML+CSS) ----- */
      .farming-pane-body { padding: 0; display: flex; flex-direction: column; gap: 16px; }
      .loft-section {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 20px;
      }
      .loft-grid {
        display: grid;
        grid-template-columns: repeat(4, minmax(0, 1fr));
        gap: 12px;
        max-width: 100%;
        width: 100%;
        margin: 0 auto 20px;
      }
      @media (min-width: 420px) {
        .loft-grid { max-width: 420px; }
      }
      @media (min-width: 768px) {
        .loft-grid { max-width: 520px; gap: 16px; }
      }
      .loft-cell {
        position: relative;
        aspect-ratio: 1;
        min-height: 0;
        width: 100%;
        max-width: 100%;
        background: var(--bg-elevated);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
      }
      @media (min-width: 480px) {
        .loft-cell { min-height: 96px; }
      }
      @media (min-width: 768px) {
        .loft-cell { min-height: 120px; }
      }
      .loft-cell.locked { opacity: 0.5; pointer-events: none; }
      .loft-cell img {
        width: 100%;
        height: 100%;
        object-fit: contain;
      }
      .farming-accrual-hint {
        min-height: 24px;
        font-size: 14px;
        font-weight: 500;
        color: var(--accent);
        text-align: center;
        caret-color: transparent;
        user-select: none;
      }
      .loft-section, .loft-grid, .loft-cell {
        caret-color: transparent;
        user-select: none;
      }
      .loft-cell:focus, .farming-accrual-hint:focus {
        outline: none;
      }

      /* ----- Deck pane (HTML+CSS) ----- */
      /* 常に上下配置：デッキを上・インベントリを下。デッキの鳥を大きくして主役に。 */
      .deck-pane-body {
        padding: 0;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
      .deck-empty-hint {
        font-size: 14px;
        color: var(--text-muted);
        text-align: center;
        padding: 24px 16px;
        margin: 0;
      }
      .deck-empty-hint.deck-empty-hint--hidden { display: none !important; }
      .deck-content-with-birds {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
      .deck-content-with-birds.deck-content-with-birds--hidden { display: none !important; }
      .deck-onboarding-cta {
        padding: 16px;
        margin-bottom: 16px;
        background: var(--accent-dim);
        border: 1px solid var(--accent);
        border-radius: var(--radius);
        text-align: center;
      }
      .deck-onboarding-cta-text { margin: 0 0 12px 0; font-size: 14px; color: var(--text); }
      .deck-section, .inventory-section {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 20px;
        min-width: 0;
      }
      .deck-section-title, .inventory-section-title {
        font-size: 14px;
        font-weight: 600;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.06em;
        margin: 0 0 12px 0;
      }
      .deck-grid {
        display: grid;
        grid-template-columns: repeat(4, minmax(0, 1fr));
        gap: 12px;
        max-width: 100%;
        margin: 0 auto;
        width: 100%;
      }
      @media (min-width: 420px) {
        .deck-grid { max-width: 420px; }
      }
      @media (min-width: 768px) {
        .deck-grid { max-width: 520px; gap: 16px; }
      }
      .deck-slot {
        aspect-ratio: 1;
        min-height: 0;
        width: 100%;
        max-width: 100%;
        background: var(--bg-elevated);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: background 0.15s, border-color 0.15s;
      }
      /* 余裕がある幅のときだけスロットを大きく（狭い幅では min-height:0 で枠に収める） */
      @media (min-width: 480px) {
        .deck-slot { min-height: 96px; }
      }
      @media (min-width: 768px) {
        .deck-slot { min-height: 120px; }
      }
      .deck-slot:hover:not(.locked) { background: var(--bg-card); border-color: var(--text-muted); }
      .deck-slot.locked { opacity: 0.5; cursor: not-allowed; }
      .deck-slot.selected { border-color: var(--accent); box-shadow: 0 0 0 2px var(--accent-dim); }
      .deck-slot .deck-slot-id { font-size: 11px; color: var(--text-muted); position: absolute; top: 4px; left: 6px; }
      .deck-slot .deck-slot-bird { width: 100%; height: 100%; object-fit: contain; }
      .deck-slot { position: relative; }
      .inventory-hint {
        font-size: 12px;
        color: var(--text-muted);
        margin: 0 0 12px 0;
      }
      .inventory-hint.deck-section-hint {
        margin-top: 12px;
        margin-bottom: 0;
      }
      .inventory-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 8px;
              }
      .inventory-cell {
        background: var(--bg-elevated);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 8px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
        cursor: pointer;
        transition: background 0.15s, border-color 0.15s;
        min-width: 0;
      }
      .inventory-cell:hover { background: var(--bg-card); border-color: var(--text-muted); }
      .inventory-cell.selected { border-color: var(--accent); box-shadow: 0 0 0 2px var(--accent-dim); }
      .inventory-cell:disabled { opacity: 0.5; cursor: not-allowed; }
      .inventory-cell img { width: 100%; max-width: 56px; height: auto; aspect-ratio: 1; object-fit: contain; }
      .inventory-cell .inventory-count { font-size: 12px; font-variant-numeric: tabular-nums; color: var(--accent); }
      .inventory-cell.unowned {
        justify-content: center;
      }
      .inventory-cell.unowned .inventory-unowned {
        font-size: 28px;
        font-weight: 600;
        color: var(--text-muted);
        line-height: 1;
      }

      /* ----- Loft upgrade modal ----- */
      .loft-modal-backdrop {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.6);
        z-index: 1000;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }
      .loft-modal-backdrop.visible { display: flex; }
      .loft-modal {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 24px;
        max-width: 360px;
        width: 100%;
      }
      .loft-modal-title { font-size: 18px; margin: 0 0 12px 0; color: var(--text); }
      .loft-modal-cost { font-size: 14px; color: var(--text-muted); margin: 0 0 20px 0; }
      .loft-modal-actions { display: flex; gap: 12px; justify-content: flex-end; }
      .loft-modal-cancel, .loft-modal-confirm {
        min-height: 40px;
        padding: 0 20px;
        font-size: 14px;
        font-weight: 500;
        border-radius: var(--radius);
        cursor: pointer;
      }
      .loft-modal-cancel {
        background: var(--bg-elevated);
        border: 1px solid var(--border);
        color: var(--text);
      }
      .loft-modal-confirm {
        background: var(--accent);
        border: none;
        color: #fff;
      }
      .loft-modal-confirm:hover:not(:disabled) { opacity: 0.95; }
      .loft-modal-confirm:disabled { opacity: 0.6; cursor: not-allowed; }

      .debug-pane-body { padding: 0; display: flex; flex-direction: column; gap: 16px; }
      .debug-section {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 16px 20px;
      }
      .debug-row {
        display: flex;
        align-items: center;
        gap: 12px;
        min-height: 40px;
        flex-wrap: wrap;
      }
      .debug-row + .debug-row { margin-top: 12px; }
      .debug-row-readonly { margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--border); }
      .debug-label {
        font-size: 12px;
        font-weight: 500;
        color: var(--text-muted);
        min-width: 72px;
      }
      .debug-value {
        font-size: 16px;
        font-variant-numeric: tabular-nums;
        color: var(--accent);
        min-width: 60px;
      }
      .debug-set-btn {
        padding: 6px 14px;
        font-size: 12px;
        font-weight: 500;
        color: var(--text);
        background: var(--bg-elevated);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        cursor: pointer;
      }
      .debug-set-btn:hover { background: var(--bg-hover); border-color: var(--text-muted); }
      .debug-loft-btns { display: flex; gap: 8px; }
      .debug-loft-btn {
        width: 32px;
        height: 28px;
        padding: 0;
        font-size: 12px;
        font-weight: 500;
        color: var(--text);
        background: var(--bg-elevated);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        cursor: pointer;
      }
      .debug-loft-btn:hover { background: var(--bg-hover); }
      .debug-section-reset { margin-top: 0; padding-top: 16px; border-top: 1px solid var(--border); }
      .debug-reset-btn {
        width: 100%;
        min-height: 44px;
        font-size: 14px;
        font-weight: 500;
        color: var(--text);
        background: var(--bg-elevated);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        cursor: pointer;
        transition: background 0.15s, border-color 0.15s;
      }
      .debug-reset-btn:hover { background: var(--bg-hover); border-color: var(--text-muted); }

      /* ----- Gacha confirm modal ----- */
      .gacha-modal-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.6);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 200;
      }
      .gacha-modal-backdrop.visible { display: flex; }
      .gacha-modal {
        max-width: 360px;
        width: calc(100% - 40px);
        background: var(--bg-card);
        border-radius: var(--radius);
        border: 1px solid var(--border);
        padding: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
      }
      .gacha-modal-title {
        margin: 0 0 12px 0;
        font-size: 18px;
        font-weight: 600;
        color: var(--text);
      }
      .gacha-modal-text {
        margin: 0 0 16px 0;
        font-size: 14px;
        color: var(--text-muted);
      }
      .gacha-modal-actions {
        display: flex;
        justify-content: flex-end;
        gap: 8px;
      }
      .gacha-modal-cancel,
      .gacha-modal-confirm {
        min-height: 40px;
        padding: 0 16px;
        font-size: 14px;
        font-weight: 500;
        border-radius: var(--radius);
        border: 1px solid var(--border);
        cursor: pointer;
      }
      .gacha-modal-cancel {
        background: transparent;
        color: var(--text-muted);
      }
      .gacha-modal-cancel:hover { background: var(--bg-hover); }
      .gacha-modal-confirm {
        background: var(--accent);
        color: #fff;
        border-color: transparent;
      }
      .gacha-modal-confirm[disabled] {
        opacity: 0.5;
        cursor: not-allowed;
      }

      /* ----- Status cards: fixed on all tabs (sticky in scroll area) ----- */
      .status-cards {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        width: 100%;
      }
      /* 幅が十分あるときだけ4列。狭いときは2x2で見やすく */
      @media (min-width: 640px) {
        .status-cards { grid-template-columns: repeat(4, 1fr); }
      }
      .status-cards-global {
        /* No sticky: status bar is outside scroll area, so position is always the same */
      }
      .status-card {
        display: flex;
        flex-direction: column;
        min-width: 0;
        padding: 8px 12px;
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
      }
      .status-card-label {
        font-size: 10px;
        font-weight: 500;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.06em;
        line-height: 1.15;
        min-height: 2em;
        margin-bottom: 0;
      }
      .status-card-value {
        font-size: 18px;
        font-weight: 600;
        font-variant-numeric: tabular-nums;
        color: var(--accent);
        margin-top: auto;
      }
      @media (min-width: 768px) {
        .status-card-value { font-size: 20px; }
      }
      .status-card-seed-row {
        display: flex;
        align-items: baseline;
        gap: 6px;
        margin-top: auto;
        flex-wrap: wrap;
        min-width: 0;
      }
      .status-card-seed-row .status-card-value { margin-top: 0; min-width: 0; }
      .status-card-seed-delta {
        font-size: 11px;
        font-weight: 500;
        color: var(--accent);
        user-select: none;
        -webkit-user-select: none;
        caret-color: transparent;
      }
      .status-card-loft .status-card-value-row {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-top: auto;
        flex-wrap: wrap;
        min-width: 0;
      }
      .status-card-loft .status-card-value-row .status-card-value { margin-top: 0; min-width: 0; }
      .status-loft-upgrade-btn {
        flex-shrink: 0;
        padding: 4px 10px;
        font-size: 11px;
        font-weight: 500;
        color: var(--text);
        background: var(--bg-elevated);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        cursor: pointer;
        transition: background 0.15s, border-color 0.15s;
        user-select: none;
        -webkit-user-select: none;
        caret-color: transparent;
      }
      .status-loft-upgrade-btn:hover:not(:disabled) {
        background: var(--bg-card);
        border-color: var(--text-muted);
      }
      .status-loft-upgrade-btn:disabled { opacity: 0.5; cursor: not-allowed; }
      .status-loft-upgrade-btn:focus { outline: none; }

      /* ----- Canvas card (Adopt 時は画面外に移すだけ。display:none にすると親が 0x0 になり Phaser の scale が壊れる) ----- */
      .canvas-card-hidden {
        position: absolute !important;
        left: -9999px !important;
        top: 0 !important;
        visibility: hidden !important;
        pointer-events: none !important;
      }
      .canvas-card {
        flex: 1;
        min-width: 0; /* flex で幅が子(canvas)に引きずられないようにする。これがないと狭い幅で横スクロールのままになる */
        min-height: 320px;
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        overflow: hidden;
        display: flex;
        align-items: stretch;
        justify-content: stretch;
      }
      @media (min-width: 768px) {
        .canvas-card { min-height: 560px; }
      }
      .canvas-card #app {
        flex: 1;
        min-width: 0; /* 同上。Phaser の getParentBounds() が #app の幅を読むため、ここが縮まらないと狭い幅でレイアウトが切り替わらない */
        min-height: 280px;
        position: relative;
        display: flex;
        align-items: flex-start;
        justify-content: center;
      }
      @media (min-width: 768px) {
        .canvas-card #app { min-height: 360px; }
      }
      /* Canvas: let Phaser control size (FIT = fixed aspect). Align to top so deck content starts under tabs. */
      .canvas-card #app canvas { display: block; margin-top: 0 !important; }
      .canvas-card.canvas-card-deck-view {
        min-height: 1100px;
        /* ゲーム背景(BG_CARD)と揃え、下部の色の違和感を防ぐ */
        background: #12121a;
      }

      /* ----- Placeholder / tip ----- */
      .placeholder-pane {
        padding: 16px 20px;
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        font-size: 13px;
        color: var(--text-muted);
        line-height: 1.5;
      }
      @media (min-width: 768px) {
        .placeholder-pane { padding: 20px 24px; }
      }

      /* ----- Safe area (notch / home indicator) ----- */
      @supports (padding-bottom: env(safe-area-inset-bottom)) {
        .shell-content { padding-bottom: calc(var(--content-pad) + env(safe-area-inset-bottom)); }
        .shell-tabs { padding-left: calc(var(--content-pad) + env(safe-area-inset-left)); padding-right: calc(var(--content-pad) + env(safe-area-inset-right)); }
        .shell-header { padding-left: calc(var(--content-pad) + env(safe-area-inset-left)); padding-right: calc(var(--content-pad) + env(safe-area-inset-right)); }
      }
    </style>
  </head>
  <body>
    <div id="title-ui" aria-hidden="true">
      <span class="title-text">Bird Game</span>
      <span class="subtitle">Connect your wallet to play</span>
      <button type="button" id="connect-wallet-btn">Connect Wallet</button>
    </div>

    <div id="game-shell" aria-hidden="true">
      <header class="shell-header">
        <div class="shell-header-left">
          <span class="shell-logo">Bird Game</span>
          <span class="shell-subtitle">Play-to-Earn Bird Game</span>
        </div>
        <div class="shell-wallet-row">
          <div class="shell-wallet">
            <span class="shell-wallet-address" id="shell-wallet-address">0x1234…abcd</span>
          </div>
          <button type="button" class="shell-theme-btn" id="shell-theme-btn" title="Toggle light/dark theme" aria-label="Toggle theme">
            <svg class="theme-icon-dark" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
            <svg class="theme-icon-light" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
          </button>
          <button type="button" class="shell-disconnect-btn" id="shell-disconnect-btn" title="Disconnect wallet" aria-label="Disconnect wallet">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
          </button>
        </div>
      </header>
      <nav class="shell-tabs">
        <button type="button" class="shell-tab active" data-tab="farming">Farming</button>
        <button type="button" class="shell-tab" data-tab="adopt">Adopt</button>
        <button type="button" class="shell-tab" data-tab="deck">Loft</button>
        <button type="button" class="shell-tab" data-tab="debug">Debug</button>
      </nav>
      <main class="shell-content">
        <div class="shell-content-inner" id="shell-content-inner">
          <div class="status-panel">
            <div class="status-cards status-cards-global">
              <div class="status-card">
                <div class="status-card-label">Current SEED</div>
                <div class="status-card-seed-row">
                  <div class="status-card-value" id="dom-seed">0</div>
                  <span class="status-card-seed-delta" id="farming-accrual-hint" aria-live="polite"></span>
                </div>
              </div>
              <div class="status-card">
                <div class="status-card-label">SEED/day</div>
                <div class="status-card-value" id="dom-seed-per-day">0</div>
              </div>
              <div class="status-card">
                <div class="status-card-label">Network Share</div>
                <div class="status-card-value" id="dom-network-share">—%</div>
              </div>
              <div class="status-card status-card-loft">
                <div class="status-card-label">Loft Lv</div>
                <div class="status-card-value-row">
                  <div class="status-card-value" id="dom-loft-level">1</div>
                  <button type="button" class="status-loft-upgrade-btn" id="status-loft-upgrade-btn">Upgrade</button>
                </div>
              </div>
            </div>
          </div>
          <div id="pane-farming" class="tab-pane active">
            <div class="farming-pane-body">
              <div class="loft-section">
                <div class="loft-grid" id="loft-grid" role="grid" aria-label="Loft slots" tabindex="-1">
                  <!-- 4x2 cells filled by JS -->
                </div>
              </div>
            </div>
          </div>
          <div id="pane-adopt" class="tab-pane">
            <div class="adopt-pane-body">
              <div class="gacha-cta">
                <div class="gacha-option">
                  <button type="button" class="shell-gacha-spin-btn" id="shell-gacha-1">Adopt 1x</button>
                  <div class="gacha-cost" id="gacha-cost-1"></div>
                </div>
                <div class="gacha-option">
                  <button type="button" class="shell-gacha-spin-btn" id="shell-gacha-10">Adopt 10x</button>
                  <div class="gacha-cost" id="gacha-cost-10"></div>
                </div>
              </div>
              <div class="gacha-results-section gacha-results-section--hidden" id="gacha-results-section">
                <div class="gacha-results-label">Adopted birds</div>
                <div class="gacha-results-area" id="gacha-results-area">
                  <p class="gacha-results-empty" id="gacha-results-empty">No birds adopted yet.</p>
                </div>
              </div>
            </div>
          </div>
          <div id="pane-deck" class="tab-pane">
            <div class="deck-pane-body">
              <p class="deck-empty-hint" id="deck-empty-hint">Adopt a bird first in the Adopt tab.</p>
              <div class="deck-content-with-birds deck-content-with-birds--hidden" id="deck-content-with-birds">
                <div class="deck-onboarding-cta" id="deck-onboarding-cta" style="display: none;">
                  <p class="deck-onboarding-cta-text">Bird placed! Go to Farming to start earning SEED.</p>
                  <button type="button" class="shell-gacha-spin-btn" id="deck-onboarding-goto-farming">Go to Farming</button>
                </div>
                <section class="deck-section" aria-label="Loft">
                  <h3 class="deck-section-title">Loft</h3>
                  <div class="deck-grid" id="deck-grid" role="grid">
                    <!-- 8 slots filled by JS -->
                  </div>
                </section>
                <section class="inventory-section" aria-label="Inventory">
                  <h3 class="inventory-section-title">Inventory</h3>
                  <div class="inventory-grid" id="inventory-grid" role="grid">
                    <!-- cells filled by JS -->
                  </div>
                </section>
              </div>
            </div>
          </div>
          <div id="pane-debug" class="tab-pane">
            <div class="debug-pane-body">
              <div class="debug-section">
                <div class="debug-row">
                  <span class="debug-label">SEED</span>
                  <span class="debug-value" id="dom-debug-seed">0</span>
                  <button type="button" class="debug-set-btn" id="dom-debug-seed-set">Set</button>
                </div>
                <div class="debug-row">
                  <span class="debug-label">$Bird</span>
                  <span class="debug-value" id="dom-debug-bird">0</span>
                  <button type="button" class="debug-set-btn" id="dom-debug-bird-set">Set</button>
                </div>
                <div class="debug-row">
                  <span class="debug-label">Loft Level</span>
                  <span class="debug-value" id="dom-debug-loft">1</span>
                  <div class="debug-loft-btns">
                    <button type="button" class="debug-loft-btn" data-level="1">1</button>
                    <button type="button" class="debug-loft-btn" data-level="2">2</button>
                    <button type="button" class="debug-loft-btn" data-level="3">3</button>
                    <button type="button" class="debug-loft-btn" data-level="4">4</button>
                    <button type="button" class="debug-loft-btn" data-level="5">5</button>
                    <button type="button" class="debug-loft-btn" data-level="6">6</button>
                  </div>
                </div>
              </div>
              <div class="debug-section debug-section-reset">
                <button type="button" class="debug-reset-btn" id="dom-debug-reset">Reset (return to onboarding)</button>
              </div>
            </div>
          </div>
          <!-- Gacha confirm modal -->
          <div class="gacha-modal-backdrop" id="gacha-modal-backdrop" aria-hidden="true">
            <div class="gacha-modal" role="dialog" aria-labelledby="gacha-modal-title">
              <h2 class="gacha-modal-title" id="gacha-modal-title">Confirm Adoption</h2>
              <p class="gacha-modal-text" id="gacha-modal-text"></p>
              <div class="gacha-modal-actions">
                <button type="button" class="gacha-modal-cancel" id="gacha-modal-cancel">Cancel</button>
                <button type="button" class="gacha-modal-confirm" id="gacha-modal-confirm">Confirm</button>
              </div>
            </div>
          </div>
          <div class="canvas-card" id="shell-canvas-card">
            <div id="app"></div>
          </div>

          <!-- Loft upgrade confirm modal (DOM-driven) -->
          <div class="loft-modal-backdrop" id="loft-modal-backdrop" aria-hidden="true">
            <div class="loft-modal" id="loft-modal" role="dialog" aria-labelledby="loft-modal-title">
              <h2 class="loft-modal-title" id="loft-modal-title">Upgrade Loft</h2>
              <p class="loft-modal-cost" id="loft-modal-cost"></p>
              <div class="loft-modal-actions">
                <button type="button" class="loft-modal-cancel" id="loft-modal-cancel">Cancel</button>
                <button type="button" class="loft-modal-confirm" id="loft-modal-confirm">Upgrade</button>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
