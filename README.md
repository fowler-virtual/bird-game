# Bird Game（最小プロトタイプ）

Phaser 3 + TypeScript + Vite で動作するブラウザゲームのプロトタイプです。

## 起動方法

```bash
npm install
npm run dev
```

ブラウザで表示された URL（通常は http://localhost:5173）を開いてください。

## 仕様

- **画面上部**: 宝石4種（Sapphire / Ruby / Emerald / Diamond）の所持数を常時表示
- **デッキ**: 枠 A〜H を8個表示。初期は A・B のみ解放、C〜H はロック（Sapphire + $SEED で順に解放可能）
- **待機リスト**: 所持鳥一覧。鳥をクリック → 配置先デッキ枠を選択して配置
- **ガチャ**: オンチェーンの $SEED を消費して鳥を獲得。獲得鳥は待機リストに追加
- **宝石増加**: デッキに鳥が1羽以上配置されているとき、経過時間で Sapphire が増加（毎秒チェック・加算は floor）
- **$SEED**: オンチェーンで保持。ガチャや Loft アップグレードのコストに使用。接続時にチェーンから残高を取得
- データは localStorage に保存（ゲーム状態同期の導入後はサーバーを正とする想定）

## 確認手順

1. **デッキに鳥を置く**  
   ガチャで鳥を獲得し、待機リストから鳥を1羽クリック → 配置先のデッキ枠（A〜H の解放済み枠）を選んで配置する。

2. **ガチャへ行って鳥を引く**  
   「ガチャ」ボタンでガチャ画面へ。「1回引く (10 $SEED)」で鳥を1羽引く。「戻る」でメイン画面へ。

3. **戻ってデッキ/通貨/宝石が正しく反映される**  
   「戻る」でメイン画面に戻り、デッキに配置した鳥がそのまま表示されていること、$SEED が減っていること、Sapphire が経過で増えていることを確認する。

4. **デッキ解放**  
   ロック中の枠（C〜H）をクリック → 解放確認UIでコストを確認。足りていれば「解放」で枠を解放できる。不足時は「Sapphire が不足しています」等のメッセージが表示される。枠は C→D→E→F→G→H の順でしか解放できない。

5. **リロード後も永続化**  
   画面をリロード（F5）すると、宝石・デッキ・待機リスト・$SEED 残高（チェーンから再取得）・解放状態が復元される。

## 検証開始条件（DoR）とスモークテスト

監査・UI 検証の前に、TOP 表示・Connect Wallet 反応・タブ遷移ができることを確認するスモークテストを用意しています。

- **実行**: `pnpm test:e2e` または `npm run test:e2e`
- **初回のみ**: `pnpm exec playwright install chromium` でブラウザをインストール
- 詳細な検証開始条件と実行手順は [docs/VERIFICATION_READINESS.md](docs/VERIFICATION_READINESS.md) を参照

E2E 時は `VITE_E2E_MODE=1` でウォレットをモックし、MetaMask なしで接続済み状態の UI を検証できます。本番の挙動は変わりません。

## ビルド

```bash
npm run build
npm run preview
```
